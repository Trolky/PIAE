{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "Projects" %} â€¢ {% trans "PIAE" %}{% endblock %}

{% block content %}
  <div class="page">
    <h1>{% trans "Projects" %}</h1>

    {% if role == 'CUSTOMER' %}
      <p class="muted">{% trans "Your created projects." %}</p>
    {% elif role == 'TRANSLATOR' %}
      <p class="muted">{% trans "Projects assigned to you." %}</p>
    {% else %}
      <p class="muted">{% trans "Projects." %}</p>
    {% endif %}

    {% if not projects %}
      <div class="card">
        <p class="muted">{% trans "No projects yet." %}</p>
      </div>
    {% else %}
      <div class="card">
        <div class="table-wrap">
          <table class="table" data-projects-table>
            <thead>
              <tr>
                <th></th>
                <th data-sort-key="file"><span class="table__th-label">{% trans "File" %}</span></th>
                <th data-sort-key="language"><span class="table__th-label">{% trans "Language" %}</span></th>
                <th data-sort-key="state"><span class="table__th-label">{% trans "Status" %}</span></th>
                {% if role == 'CUSTOMER' %}
                  <th data-sort-key="translator"><span class="table__th-label">{% trans "Translator" %}</span></th>
                {% elif role == 'TRANSLATOR' %}
                  <th data-sort-key="customer"><span class="table__th-label">{% trans "Customer" %}</span></th>
                {% endif %}
                <th data-sort-key="created"><span class="table__th-label">{% trans "Created" %}</span></th>
              </tr>
            </thead>
            <tbody>
              {% for p in projects %}
                <tr
                  data-state="{{ p.state|default:'' }}"
                  data-file="{{ p.original_file_name|default:'' }}"
                  data-language="{{ p.language_code|default:'' }}"
                  data-created="{{ p.created_at|default:'' }}"
                  data-customer="{{ p.customer_name|default:p.customer_id }}"
                  data-translator="{{ p.translator_name|default:p.translator_id }}"
                >
                  <td style="white-space:nowrap;">
                    {% if role == 'CUSTOMER' %}
                      {% if p.state == 'COMPLETED' %}
                        <a class="button button--small" href="{% url 'project_detail_customer' p.id %}">{% trans "Review" %}</a>
                      {% else %}
                        <a class="button button--small button--ghost" href="{% url 'project_detail_customer' p.id %}">{% trans "Info" %}</a>
                      {% endif %}
                    {% elif role == 'TRANSLATOR' %}
                      {% if p.state == 'ASSIGNED' %}
                        <a class="button button--small" href="{% url 'project_detail_translator' p.id %}">{% trans "Open" %}</a>
                      {% else %}
                        <a class="button button--small button--ghost" href="{% url 'project_detail_translator' p.id %}">{% trans "Info" %}</a>
                      {% endif %}
                    {% endif %}
                  </td>

                  <td class="mono">
                    {% if p.original_file_name %}
                      {{ p.original_file_name }}
                    {% else %}
                      <span class="muted">({% trans "unknown" %})</span>
                    {% endif %}
                  </td>
                  <td>{{ p.language_code|upper }}</td>
                  <td>
                    <span class="badge">{{ p.state }}</span>
                  </td>

                  {% if role == 'CUSTOMER' %}
                    <td>
                      {% if p.translator_name %}
                        {{ p.translator_name }}
                      {% elif p.translator_id %}
                        <span class="muted">{% trans "Assigned" %}</span>
                      {% else %}
                        <span class="muted">{% trans "Unassigned" %}</span>
                      {% endif %}
                    </td>
                  {% elif role == 'TRANSLATOR' %}
                    <td>
                      {% if p.customer_name %}
                        {{ p.customer_name }}
                      {% else %}
                        <span class="muted">{{ p.customer_id }}</span>
                      {% endif %}
                    </td>
                  {% endif %}

                  <td class="muted">{{ p.created_at|default:"" }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <p class="muted" style="margin:10px 2px 0;">{% trans "Tip: click a column header to sort." %}</p>
      </div>
    {% endif %}
  </div>
{% endblock %}
